<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fun.yizhierha.operation.mapper.OraDeployMapper">
    <resultMap id="BaseResultMap" type="fun.yizhierha.operation.domain.OraDeploy">
        <!--generated by EH-Admin @date Wed Dec 21 15:42:52 CST 2022-->
        <!--@Table ora_deploy-->
        <id column="deploy_id" property="id"/>
        <result column="app_id" property="appId"/>
        <result column="create_by" property="createBy"/>
        <result column="update_by" property="updateBy"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <association property="app" javaType="fun.yizhierha.operation.domain.OraApp" columnPrefix="classify_"
                     select="queryAppByClassId" column="app_id">
            <id property="id" column="app_id"></id>
            <result property="name" column="name"/>
            <result property="uploadPath" column="upload_path"/>
            <result property="deployPath" column="deploy_path"/>
            <result property="backupPath" column="backup_path"/>
            <result property="port" column="port"/>
            <result property="startScript" column="start_script"/>
            <result property="deployScript" column="deploy_script"/>
            <result property="createBy" column="create_by"/>
            <result property="updateBy" column="update_by"/>
            <result property="createTime" column="create_time"/>
            <result property="updateTime" column="update_time"/>
        </association>
        <collection property="server" ofType="fun.yizhierha.operation.domain.OraServer" column="deploy_id"
                    select="queryServerByClassId">
            <id property="id" column="server_id"></id>
            <result property="account" column="account"/>
            <result property="ip" column="ip"/>
            <result property="name" column="name"/>
            <result property="port" column="port"/>
            <result property="createBy" column="create_by"/>
            <result property="updateBy" column="update_by"/>
            <result property="createTime" column="create_time"/>
            <result property="updateTime" column="update_time"/>
        </collection>
    </resultMap>
    <sql id="Base_Column_List">
        `deploy_id`
        ,
        `app_id`,
        `create_by`,
        `update_by`,
        `create_time`,
        `update_time`,
        `project_id`,
        `server_id`
    </sql>
    <select id="queryAppByClassId" resultType="fun.yizhierha.operation.domain.OraApp">
        select *
        from ora_app
        where app_id = #{id}
    </select>

    <select id="queryServerByClassId" resultType="fun.yizhierha.operation.domain.OraServer">
        SELECT os.*
        FROM ora_deploy od
                 LEFT JOIN ora_deploy_server ods ON od.deploy_id = ods.deploy_id
                 LEFT JOIN ora_project op ON ods.project_id = op.project_id
                 LEFT JOIN ora_server os ON os.server_id = ods.server_id
        where od.deploy_id = #{id}
    </select>

    <select id="selectById" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT od.*
        FROM ora_deploy od
                 LEFT JOIN ora_deploy_server ods ON od.deploy_id = ods.deploy_id
                 LEFT JOIN ora_project op ON ods.project_id = op.project_id
                 LEFT JOIN ora_server os ON os.server_id = ods.server_id
        where od.deploy_id = #{id}
    </select>

</mapper>